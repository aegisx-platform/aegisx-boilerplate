# Thumbnail Generation Service

## Overview

AegisX Storage Service ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á thumbnail ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Sharp library ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÅ‡∏ö‡∏ô‡∏î‡πå‡∏ß‡∏¥‡∏ò

## Features

- ‚úÖ **Optional Thumbnail Generation** - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á thumbnail ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‚úÖ **Multiple Size Support** - ‡∏™‡∏£‡πâ‡∏≤‡∏á thumbnail ‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
- ‚úÖ **Custom Size Configuration** - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á
- ‚úÖ **High Performance** - ‡πÉ‡∏ä‡πâ Sharp library ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
- ‚úÖ **Format Support** - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPEG, PNG, WebP
- ‚úÖ **Fit Options** - ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢ (cover, contain, inside, etc.)
- ‚úÖ **Quality Control** - ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ
- ‚úÖ **Non-blocking** - ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á thumbnail ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ upload fail
- ‚úÖ **API Integration** - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Storage API ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

## Installation

Thumbnail generation ‡πÉ‡∏ä‡πâ Sharp library ‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß:

```bash
# Sharp ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô dependencies
npm list sharp
# @aegisx-boilerplate/api@0.0.1 -> ./apps/api
#   ‚îî‚îÄ‚îÄ sharp@0.34.2
```

## Configuration

### Environment Variables

```bash
# Storage Provider (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á local ‡πÅ‡∏•‡∏∞ minio)
STORAGE_PROVIDER=local|minio
STORAGE_ENABLED=true

# Local Storage Configuration
STORAGE_LOCAL_BASE_PATH=./storage
STORAGE_LOCAL_PERMISSIONS=0755
STORAGE_LOCAL_MAX_FILE_SIZE=104857600  # 100MB
STORAGE_LOCAL_MAX_FILES=10000

# MinIO Configuration (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö thumbnail ‡πÉ‡∏ô MinIO)
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_USE_SSL=false
MINIO_ACCESS_KEY=your-access-key
MINIO_SECRET_KEY=your-secret-key
MINIO_BUCKET=aegisx-storage
MINIO_REGION=us-east-1
```

### Default Thumbnail Sizes

‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ `thumbnailSizes` ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:

```typescript
const DEFAULT_SIZES = [
  { width: 150, height: 150, fit: 'cover', quality: 80, format: 'jpeg' },
  { width: 300, height: 300, fit: 'cover', quality: 85, format: 'jpeg' },
  { width: 800, height: 600, fit: 'inside', quality: 90, format: 'jpeg' }
]
```

## API Usage

### Upload with Thumbnail Generation

#### Basic Usage (Default Sizes)

```bash
curl -X POST http://localhost:3000/storage/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@image.jpg" \
  -F "generateThumbnail=true"
```

#### Custom Thumbnail Sizes

```bash
curl -X POST http://localhost:3000/storage/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@image.jpg" \
  -F "generateThumbnail=true" \
  -F 'thumbnailSizes=[
    {"width":100,"height":100,"fit":"cover","quality":90},
    {"width":500,"height":500,"fit":"inside","quality":85,"format":"webp"}
  ]'
```

#### Without Thumbnails (Default)

```bash
curl -X POST http://localhost:3000/storage/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@image.jpg" \
  -F "generateThumbnail=false"
```

### API Response

‡πÄ‡∏°‡∏∑‡πà‡∏≠ upload ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏à‡∏∞‡πÑ‡∏î‡πâ response ‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏° thumbnail URLs:

```json
{
  "success": true,
  "fileId": "12345678-1234-1234-1234-123456789abc",
  "filename": "image.jpg",
  "size": 2048576,
  "mimeType": "image/jpeg",
  "checksum": "sha256hash...",
  "thumbnails": [
    {
      "url": "/storage/thumbnails/12345678-1234-1234-1234-123456789abc/150x150.jpeg",
      "width": 150,
      "height": 150,
      "size": 8192,
      "format": "jpeg"
    },
    {
      "url": "/storage/thumbnails/12345678-1234-1234-1234-123456789abc/300x300.jpeg",
      "width": 300,
      "height": 300,
      "size": 15360,
      "format": "jpeg"
    },
    {
      "url": "/storage/thumbnails/12345678-1234-1234-1234-123456789abc/800x600.jpeg",
      "width": 800,
      "height": 600,
      "size": 32768,
      "format": "jpeg"
    }
  ],
  "metadata": {
    // ... file metadata
  }
}
```

### Download Thumbnails

```bash
# ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î thumbnail
GET /storage/thumbnails/:fileId/:filename

# ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:3000/storage/thumbnails/12345678-1234-1234-1234-123456789abc/150x150.jpeg
```

## Frontend Integration

### Angular Example

```typescript
export class FileUploadService {
  
  async uploadWithThumbnails(file: File, generateThumbnails = true): Promise<UploadResponse> {
    const formData = new FormData()
    formData.append('file', file)
    formData.append('generateThumbnail', generateThumbnails.toString())
    
    // Custom thumbnail sizes (optional)
    if (generateThumbnails) {
      const customSizes = [
        { width: 200, height: 200, fit: 'cover', quality: 90 },
        { width: 400, height: 300, fit: 'inside', quality: 85 }
      ]
      formData.append('thumbnailSizes', JSON.stringify(customSizes))
    }
    
    return this.http.post<UploadResponse>('/storage/upload', formData).toPromise()
  }
  
  getThumbnailUrl(fileId: string, filename: string): string {
    return `/storage/thumbnails/${fileId}/${filename}`
  }
}
```

### React Example

```typescript
import { useState } from 'react'

interface ThumbnailSize {
  width: number
  height: number
  fit?: 'cover' | 'contain' | 'inside' | 'outside'
  quality?: number
  format?: 'jpeg' | 'png' | 'webp'
}

const FileUpload: React.FC = () => {
  const [file, setFile] = useState<File | null>(null)
  const [thumbnails, setThumbnails] = useState<ThumbnailInfo[]>([])
  
  const uploadFile = async () => {
    if (!file) return
    
    const formData = new FormData()
    formData.append('file', file)
    formData.append('generateThumbnail', 'true')
    
    // Custom sizes for different use cases
    const thumbnailSizes: ThumbnailSize[] = [
      { width: 100, height: 100, fit: 'cover' },      // Profile picture
      { width: 300, height: 200, fit: 'cover' },      // Card thumbnail
      { width: 800, height: 600, fit: 'inside' }      // Preview image
    ]
    formData.append('thumbnailSizes', JSON.stringify(thumbnailSizes))
    
    try {
      const response = await fetch('/storage/upload', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`
        },
        body: formData
      })
      
      const result = await response.json()
      setThumbnails(result.thumbnails || [])
      
    } catch (error) {
      console.error('Upload failed:', error)
    }
  }
  
  return (
    <div>
      <input type="file" onChange={(e) => setFile(e.target.files?.[0] || null)} />
      <button onClick={uploadFile}>Upload with Thumbnails</button>
      
      {thumbnails.map((thumb, index) => (
        <img 
          key={index} 
          src={thumb.url} 
          alt={`Thumbnail ${thumb.width}x${thumb.height}`}
          width={thumb.width}
          height={thumb.height}
        />
      ))}
    </div>
  )
}
```

## Configuration Options

### ThumbnailSize Interface

```typescript
interface ThumbnailSize {
  width: number        // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á (pixels)
  height: number       // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á (pixels)
  fit?: 'cover' | 'contain' | 'fill' | 'inside' | 'outside'
  quality?: number     // ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û 1-100 (default: 80)
  format?: 'jpeg' | 'png' | 'webp'  // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå (default: 'jpeg')
}
```

### Fit Options

- **`cover`** - ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô (default)
- **`contain`** - ‡πÉ‡∏™‡πà‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á
- **`fill`** - ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ö‡∏¥‡∏î‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß
- **`inside`** - ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
- **`outside`** - ‡∏†‡∏≤‡∏û‡πÄ‡∏•‡πá‡∏Å‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏Å‡∏£‡∏≠‡∏ö

### Quality Settings

```typescript
// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ quality ‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô
const thumbnailSizes = [
  { width: 100, height: 100, quality: 60 },   // ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
  { width: 300, height: 300, quality: 80 },   // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á ‡∏™‡∏°‡∏î‡∏∏‡∏•
  { width: 800, height: 600, quality: 95 }    // ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á
]
```

## Storage Structure

### Local Storage

```
storage/
‚îú‚îÄ‚îÄ files/                    # ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
‚îÇ   ‚îî‚îÄ‚îÄ ab/cd/abcd1234.jpg
‚îú‚îÄ‚îÄ metadata/                 # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• metadata
‚îÇ   ‚îî‚îÄ‚îÄ abcd1234.json
‚îî‚îÄ‚îÄ thumbnails/              # thumbnails
    ‚îî‚îÄ‚îÄ abcd1234/            # ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° fileId
        ‚îú‚îÄ‚îÄ 150x150.jpeg
        ‚îú‚îÄ‚îÄ 300x300.jpeg
        ‚îî‚îÄ‚îÄ 800x600.jpeg
```

### MinIO Storage

```
minio-bucket/
‚îú‚îÄ‚îÄ files/                    # ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
‚îÇ   ‚îî‚îÄ‚îÄ ab/cd/abcd1234.jpg
‚îú‚îÄ‚îÄ metadata/                 # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• metadata
‚îÇ   ‚îî‚îÄ‚îÄ abcd1234.json
‚îî‚îÄ‚îÄ thumbnails/              # thumbnails (‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô MinIO)
    ‚îî‚îÄ‚îÄ abcd1234/            # ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° fileId
        ‚îú‚îÄ‚îÄ 150x150.jpeg
        ‚îú‚îÄ‚îÄ 300x300.jpeg
        ‚îî‚îÄ‚îÄ 800x600.jpeg
```

## Supported Image Formats

### Input Formats (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á thumbnail ‡πÑ‡∏î‡πâ)

- **JPEG** (.jpg, .jpeg)
- **PNG** (.png)
- **WebP** (.webp)
- **TIFF** (.tiff, .tif)
- **GIF** (.gif) - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ frame ‡πÅ‡∏£‡∏Å
- **SVG** (.svg)
- **AVIF** (.avif)

### Output Formats

- **JPEG** - ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏ñ‡πà‡∏≤‡∏¢ (default)
- **PNG** - ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™
- **WebP** - ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö browser ‡πÉ‡∏´‡∏°‡πà)

## Performance Considerations

### Memory Usage

```typescript
// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà ‡∏Ñ‡∏ß‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô thumbnail
const efficientSizes = [
  { width: 150, height: 150 },   // Small
  { width: 400, height: 300 }    // Medium only
]

// ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á thumbnail ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
const avoidThis = [
  { width: 2048, height: 1536 }, // ‚ùå ‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
  { width: 4096, height: 3072 }  // ‚ùå ‡πÉ‡∏ä‡πâ memory ‡∏°‡∏≤‡∏Å
]
```

### Async Processing

Thumbnail generation ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö asynchronous ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà block upload process:

```typescript
// ‡∏ñ‡πâ‡∏≤ thumbnail generation ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
// ‡∏Å‡∏≤‡∏£ upload ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ thumbnails ‡πÉ‡∏ô response
{
  "success": true,
  "fileId": "12345",
  // ... other fields
  "thumbnails": [] // ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏ñ‡πâ‡∏≤ generation ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
}
```

## Error Handling

### Common Issues

1. **‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û**
   ```json
   {
     "success": true,  // Upload ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
     "thumbnails": []  // ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ thumbnails
   }
   ```

2. **Sharp processing error**
   ```bash
   # ‡∏à‡∏∞‡∏°‡∏µ warning ‡πÉ‡∏ô logs ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà fail upload
   console.warn(`Failed to generate thumbnails for ${fileId}:`, error)
   ```

3. **Invalid thumbnail sizes**
   ```json
   {
     "error": {
       "code": "VALIDATION_ERROR",
       "message": "Each thumbnail size must have width and height as numbers"
     }
   }
   ```

### Best Practices

```typescript
// ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô upload
const validateThumbnailSizes = (sizes: ThumbnailSize[]): boolean => {
  return sizes.every(size => 
    size.width > 0 && 
    size.height > 0 && 
    size.width <= 2048 && 
    size.height <= 2048
  )
}

// ‚úÖ Handle thumbnail generation failure
const handleUploadResponse = (response: UploadResponse) => {
  if (response.success) {
    if (response.thumbnails && response.thumbnails.length > 0) {
      console.log('Upload and thumbnails successful')
    } else {
      console.warn('Upload successful but no thumbnails generated')
    }
  }
}
```

## Healthcare Compliance

### Data Classification

Thumbnails ‡∏™‡∏∑‡∏ö‡∏ó‡∏≠‡∏î data classification ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö:

```typescript
// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 'confidential'
// Thumbnails ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô 'confidential' ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô
const uploadRequest = {
  file: medicalImage,
  dataClassification: 'confidential',
  generateThumbnail: true
}
```

### Access Control

Thumbnails ‡πÉ‡∏ä‡πâ access control ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö:

```typescript
// ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå 'read' ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
// ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î thumbnail ‡πÑ‡∏î‡πâ
GET /storage/thumbnails/:fileId/:filename
// ‡∏ú‡πà‡∏≤‡∏ô middleware: checkFileAccess('read')
```

## Troubleshooting

### Thumbnail ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á

1. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà**
   ```bash
   # ‡∏î‡∏π MIME type ‡πÉ‡∏ô response
   "mimeType": "image/jpeg"  # ‚úÖ 
   "mimeType": "application/pdf"  # ‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á thumbnail
   ```

2. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Sharp installation**
   ```bash
   npm list sharp
   # ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ sharp@^0.34.2
   ```

3. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Storage provider**
   ```bash
   # Thumbnail ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á local ‡πÅ‡∏•‡∏∞ minio
   STORAGE_PROVIDER=local  # ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö
   STORAGE_PROVIDER=minio  # ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà!)
   ```

### Performance Issues

1. **Thumbnail ‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ**
   ```typescript
   // ‚ùå ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á
   { width: 2048, height: 1536 }
   
   // ‚úÖ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
   { width: 800, height: 600 }
   ```

2. **‡∏à‡∏≥‡∏ô‡∏ß‡∏ô thumbnail ‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ**
   ```typescript
   // ‚ùå ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á
   const sizes = Array.from({length: 20}, (_, i) => ({
     width: 100 + i * 50, 
     height: 100 + i * 50
   }))
   
   // ‚úÖ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 3-5 ‡∏Ç‡∏ô‡∏≤‡∏î
   const sizes = [
     { width: 150, height: 150 },
     { width: 300, height: 300 },
     { width: 600, height: 400 }
   ]
   ```

## Future Enhancements

### Planned Features

- [x] **MinIO Provider Support** - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö thumbnail ‡πÉ‡∏ô MinIO ‚úÖ **‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!**
- [ ] **Lazy Loading** - ‡∏™‡∏£‡πâ‡∏≤‡∏á thumbnail ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
- [ ] **Progressive JPEG** - ‡∏™‡∏£‡πâ‡∏≤‡∏á progressive JPEG ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö loading ‡∏ó‡∏µ‡πà‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•
- [ ] **Batch Processing** - ‡∏™‡∏£‡πâ‡∏≤‡∏á thumbnail ‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
- [ ] **Crop Modes** - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£ crop ‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢
- [ ] **Watermark Support** - ‡πÄ‡∏û‡∏¥‡πà‡∏° watermark ‡∏•‡∏á‡πÉ‡∏ô thumbnail

### Integration Ideas

- **CDN Integration** - ‡πÉ‡∏ä‡πâ CDN ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö serve thumbnails
- **Image Optimization** - ‡πÄ‡∏û‡∏¥‡πà‡∏° optimization algorithms
- **Responsive Images** - ‡∏™‡∏£‡πâ‡∏≤‡∏á srcset ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö responsive design

---

## Related Documentation

- [Storage Service](./storage-service.md) - ‡∏£‡∏∞‡∏ö‡∏ö storage ‡∏´‡∏•‡∏±‡∏Å
- [Storage Database](./storage-database.md) - ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô database
- [File Access Control](./file-access-control-plugin.md) - ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå

---

**üéØ Thumbnail Generation Service ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß! ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Healthcare ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì**